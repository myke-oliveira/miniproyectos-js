<!DOCTYPE html>
<html lang="sp">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Juego Breackout</title>
  <style>
    body {
      margin: 0;
    }
    .game-board {
      margin: 10px;
      border: 1px solid #000;
      width: 1200px;
      height: 800px;
    }

    .red {
      background: red;
    }

    .green {
      background: green;
    }

    .yellow {
      background: yellow;
    }

    .block {
      border: 1px solid #000;
      width: 100px;
      height: 20px;
      position: absolute;
    }

    .player {
      border: 1px solid #000;
      width: 200px;
      height: 20px;
      position: absolute;
      background: blue;
    }

    .projectile {
      border: 1px solid #000;
      width: 15px;
      height: 15px;
      position: absolute;
      background: gray;
    }
  </style>
</head>
<body>
  <div class="game-board"></div>
  <div></div>
  <script>

    const WIDTH = 1200;
    const HEIGHT = 800;
    const MARGIN = 10;

    const FPS = 60;
    const TIME_INCREMENT = 1000/FPS;
    let time = 0;

    const colors = ['red', 'yellow', 'green'];
    const blocks = [];

    const x0 = 55;
    const y0 = 60;
    const deltaX = 110;
    const deltaY = 40;
    const playerStep = 10;

    const projectile = {
      x: 550,
      y: 500,
      vx: 1,
      vy: 1,
      height: 15,
      width: 15,
    }

    const player = {
      x: 550,
      y: 750,
      height: 20,
      width: 200,
      action: {
        ArrowRight: () => {
          const maxX = WIDTH + MARGIN - player.width;

          player.x += playerStep;

          if (player.x >= maxX) {
            player.x = maxX;
          }

        },
        ArrowLeft: () => {
          const minX = MARGIN;

          player.x -= playerStep;

          if (player.x <+ minX) {
            player.x = minX;
          }
        }
      }
    }

    for (let i = 0; i < 6; i++) {
      let color = colors[i % 3];
      for (let j  = 0; j  < 10; j ++) {
        const block = {
          id: `block-${i}-${j}`,
          x: x0 + j * deltaX,
          y: y0 + i * deltaY,
          color,
          height: 20,
          width: 100,
        }
        blocks.push(block)
      }
    }

    elementsHTML = [];
    for (const { id, x, y, color } of blocks) {
      const blockHTML = `<div id="${id}" class="${color} block" style="top: ${y}px; left: ${x}px"></div>`;
      elementsHTML.push(blockHTML);
    }
    const playerHTML = `<div class="player" style="top: ${player.y}px; left: ${player.x}px"></div>`;
    elementsHTML.push(playerHTML);
    const projectileHTML = `<div class="projectile" style="top: ${projectile.y}px; left: ${projectile.x}px"></div>`;
    elementsHTML.push(projectileHTML);
    document.querySelector('div.game-board').insertAdjacentHTML('afterBegin', elementsHTML.join(''));

    document.onkeydown = function (event) {
      const { key } = event;

      

      player.action[key]();

      document.querySelector('div.player').style.top = `${player.y}px`;
      document.querySelector('div.player').style.left = `${player.x}px`;
    }

    function collision(body1, body2) {
      return body1.x <= body2.x && body2.x <= body1.x + body1.width && body1.y <= body2.y && body2.y <= body1.y + body1.height
        || body1.x <= body2.x + body2.width && body2.x + body2.width <= body1.x + body1.width && body1.y <= body2.y && body2.y <= body1.y + body1.height
        || body1.x <= body2.x + body2.width && body2.x + body2.width <= body1.x + body1.width && body1.y <= body2.y + body2.height && body2.y + body2.height <= body1.y + body1.height
        || body1.x <= body2.x && body2.x <= body1.x + body1.width && body1.y <= body2.y + body2.height && body2.y + body2.height <= body1.y + body1.height
        || body2.x <= body1.x && body1.x <= body2.x + body2.width && body2.y <= body1.y && body1.y <= body2.y + body2.height
        || body2.x <= body1.x + body1.width && body1.x + body1.width <= body2.x + body2.width && body2.y <= body1.y && body1.y <= body2.y + body2.height
        || body2.x <= body1.x + body1.width && body1.x + body1.width <= body2.x + body2.width && body2.y <= body1.y + body1.height && body1.y + body1.height <= body2.y + body2.height
        || body2.x <= body1.x && body1.x <= body2.x + body2.width && body2.y <= body1.y + body1.height && body1.y + body1.height <= body2.y + body2.height
    }

    function collisionDirection(projectile, obstacle) {
      
    }

  function determinant(matrix) {
    if (matrix.length !== matrix[0].length) {
      throw new Error('The matrix must be square.');
    }

    if (matrix.length === 2 && matrix[0].length === 2) {
      return matrix[0][0] * matrix[1][1] - matrix[0][1] * matrix[1][0];
    }

    let result = 0;

    for (let i = 0; i < matrix.length; i++) {
      const subMatrix = [];
      for (let j = 1; j < matrix.length; j++) {
        subMatrix.push(matrix[j].filter((_, index) => index !== i));
      }

      const subDeterminant = determinant(subMatrix);

      result += (i % 2 === 0 ? 1 : -1) * matrix[0][i] * subDeterminant;
    }

    return result;
  }


  
    const interval = setInterval(() => {
      projectile.x += projectile.vx;
      projectile.y += projectile.vy;
      document.querySelector('.projectile').style.top = `${projectile.y}px`;
      document.querySelector('.projectile').style.left = `${projectile.x}px`;

      if (collision(projectile, player) || projectile.y <= 10) {
        projectile.vy = -projectile.vy;
      }

      if (projectile.x + projectile.width >= 1200 || projectile.x <= 10) {
        projectile.vx = -projectile.vx
      }

      for (const block of blocks) {
        if (collision(projectile, block)) {
          blocks.splice(blocks.indexOf(block), 1);
          document.querySelector(`#${block.id}`).style.display = 'none';
          const direction = collisionDirection(projectile, block);
          if (direction.horizontal) {
            projectile.vx = -projectile.vx;
          }
          if (direction.vertical) {
            projectile.vy = -projectile.vy;
          }
        }
      }

      if (projectile.y + projectile.height > 810) {
        clearInterval(interval);
      }
    }, TIME_INCREMENT);
  </script>
</body>
</html>